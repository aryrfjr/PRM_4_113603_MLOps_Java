<h2>Nominal Compositions</h2>

<div *ngIf="loading">Loading...</div>
<div *ngIf="error" class="error">{{ error }}</div>

<table *ngIf="!loading && compositions.length > 0" border="1" cellpadding="8">
  <thead>
    <tr>
      <th></th>
      <th>Name</th>
      <th>Description</th>
      <th>Created At</th>
      <th>Updated At</th>
      <th>Created By</th>
      <th>Updated By</th>
    </tr>
  </thead>
  <tbody>
    <tr *ngFor="let comp of compositions">
      <td>
        <input
          type="checkbox"
          [checked]="comp.name === selectedName"
          (change)="selectRow(comp.name)"
        />
      </td>
      <td>{{ comp.name }}</td>
      <td>{{ comp.description || "-" }}</td>
      <td>{{ comp.created_at | date : "short" }}</td>
      <td>{{ comp.updated_at | date : "short" }}</td>
      <td>{{ comp.created_by }}</td>
      <td>{{ comp.updated_by }}</td>
    </tr>
  </tbody>
</table>

<p *ngIf="!loading && compositions.length === 0">No compositions found.</p>

<div *ngIf="!selectedName" class="action-buttons">
  <button (click)="toggleCreateMode()">
    {{ formMode === "create" ? "Cancel" : "+ Create New" }}
  </button>
</div>

<div *ngIf="selectedName && formMode === 'edit'" class="action-buttons">
  <button (click)="deleteSelected()">- Delete</button>
</div>

<div *ngIf="formMode" class="form-container">
  <h3>
    {{ formMode === "create" ? "Create New Composition" : "Edit Description" }}
  </h3>

  <div *ngIf="formError" class="error">{{ formError }}</div>
  <div *ngIf="formSuccess" class="success">{{ formSuccess }}</div>

  <label>
    Name *
    <input [(ngModel)]="formName" [disabled]="formMode === 'edit'" />
  </label>

  <label>
    Description
    <textarea [(ngModel)]="formDescription"></textarea>
  </label>

  <button (click)="submitForm()">
    {{ formMode === "create" ? "Create" : "Update" }}
  </button>
</div>
